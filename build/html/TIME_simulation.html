<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="./">
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Tumor immune microenvironments ST dataset simulation &mdash; Spider v1 documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=92fd9be5" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css?v=19f00094" />
      <link rel="stylesheet" type="text/css" href="_static/nbsphinx-code-cells.css?v=2aa19091" />

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="_static/jquery.js?v=5d32c60e"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="_static/documentation_options.js?v=5cb08e4e"></script>
        <script src="_static/doctools.js?v=888ff710"></script>
        <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
        <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="3D ST dataset simulation" href="3D_simulation.html" />
    <link rel="prev" title="Benchmark datasets generation" href="Benchmark_datasets_generation.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            Spider
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="Installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="Reference-based_simulation.html">Reference-based Simulation</a></li>
<li class="toctree-l1"><a class="reference internal" href="Benchmark_datasets_generation.html">Benchmark datasets generation</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Tumor immune microenvironments ST dataset simulation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#Cold">Cold</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Mixed">Mixed</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Compartmentalized">Compartmentalized</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="3D_simulation.html">3D ST dataset simulation</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Spider</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Tumor immune microenvironments ST dataset simulation</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/TIME_simulation.ipynb.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="Tumor-immune-microenvironments-ST-dataset-simulation">
<h1>Tumor immune microenvironments ST dataset simulation<a class="headerlink" href="#Tumor-immune-microenvironments-ST-dataset-simulation" title="Link to this heading"></a></h1>
<p>In this tutorial, we showcased the application of Spider in generating tumor samples with different immune microenvironments (TIME). Previous studies have shown that different tumor cells secrete various cytokines and chemokines, creating a local immune microenvironment by recruiting different types and amounts of immune cells. The spatial organization of immune phenotypes can be classified into three categories: cold, mixed, and compartmentalized. Immune cold tumors exhibit few infiltrating
immune cells, mainly macrophages. In contrast, mixed tumors have numerous immune cells intermixed with tumor cells. Compartmentalized tumors have a high proportion of immune cells, but these cells are spatially segregated from tumor cells. We utilized Spider to simulate these three types of TIME data by setting appropriate cell type proportions and transition matrices.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">spider</span> <span class="k">as</span> <span class="nn">sp</span>
<span class="kn">import</span> <span class="nn">scanpy</span> <span class="k">as</span> <span class="nn">sc</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">itertools</span>
<span class="kn">import</span> <span class="nn">anndata</span> <span class="k">as</span> <span class="nn">ad</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sc</span><span class="o">.</span><span class="n">set_figure_params</span><span class="p">(</span> <span class="n">color_map</span> <span class="o">=</span> <span class="s1">&#39;viridis&#39;</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
</pre></div>
</div>
</div>
<section id="Cold">
<h2>Cold<a class="headerlink" href="#Cold" title="Link to this heading"></a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## Cold</span>
<span class="n">Num_sample</span> <span class="o">=</span> <span class="mi">2500</span>
<span class="n">Num_celltype</span> <span class="o">=</span> <span class="mi">4</span>
<span class="n">prior</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.97</span><span class="p">,</span><span class="mf">0.01</span><span class="p">,</span><span class="mf">0.01</span><span class="p">,</span><span class="mf">0.01</span><span class="p">])</span>
<span class="n">Num_ct_sample</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">get_ct_sample</span><span class="p">(</span><span class="n">Num_celltype</span> <span class="o">=</span> <span class="n">Num_celltype</span><span class="p">,</span> <span class="n">Num_sample</span> <span class="o">=</span>  <span class="n">Num_sample</span><span class="p">,</span> <span class="n">prior</span> <span class="o">=</span> <span class="n">prior</span><span class="p">)</span>
<span class="n">target_trans</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">addictive_freq</span><span class="p">(</span><span class="n">Num_celltype</span><span class="p">)</span>
<span class="n">target_trans</span><span class="p">[</span><span class="mi">1</span><span class="p">,:]</span> <span class="o">=</span>  <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="mf">0.25</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span>
<span class="n">target_trans</span><span class="p">[</span><span class="mi">2</span><span class="p">,:]</span> <span class="o">=</span>  <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="mf">0.25</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span>
<span class="n">target_trans</span><span class="p">[</span><span class="mi">3</span><span class="p">,:]</span> <span class="o">=</span>  <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="mf">0.25</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span>
<span class="n">target_trans</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
array([[0.8       , 0.06666667, 0.06666667, 0.06666667],
       [0.25      , 0.25      , 0.25      , 0.25      ],
       [0.25      , 0.25      , 0.25      , 0.25      ],
       [0.25      , 0.25      , 0.25      , 0.25      ]])
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">res</span><span class="p">,</span> <span class="n">cell_location</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">simulate_10X</span><span class="p">(</span><span class="n">cell_num</span><span class="o">=</span><span class="n">Num_sample</span><span class="p">,</span>
                                  <span class="n">Num_celltype</span><span class="o">=</span><span class="n">Num_celltype</span><span class="p">,</span>
                                  <span class="n">prior</span><span class="o">=</span><span class="n">prior</span><span class="p">,</span>
                                  <span class="n">target_trans</span><span class="o">=</span><span class="n">target_trans</span><span class="p">,</span>
                                  <span class="n">spot_radius</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                  <span class="n">spot_min</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                  <span class="n">spot_max</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                  <span class="n">image_width</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
                                  <span class="n">image_height</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
                                  <span class="n">cell_location</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                  <span class="n">tol</span><span class="o">=</span><span class="mf">2e-2</span><span class="p">,</span>
                                  <span class="n">T</span><span class="o">=</span><span class="mf">1e-2</span><span class="p">,</span>
                                  <span class="n">loop_times</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                  <span class="n">smallsample_max_iter</span><span class="o">=</span><span class="mi">150000</span><span class="p">,</span>
                                  <span class="n">bigsample_max_iter</span><span class="o">=</span><span class="mi">10000</span><span class="p">)</span>
<br/></pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
swap_num:  1
Refine cell type using Metropolis–Hastings algorithm.
Sample num:2500
10000 iteration, error 1.325
20000 iteration, error 1.326
30000 iteration, error 1.332
40000 iteration, error 1.325
50000 iteration, error 1.312
60000 iteration, error 1.319
70000 iteration, error 1.306
80000 iteration, error 1.309
90000 iteration, error 1.306
100000 iteration, error 1.306
110000 iteration, error 1.312
120000 iteration, error 1.319
130000 iteration, error 1.306
140000 iteration, error 1.306
150000 iteration, error 1.309
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">spider_adata</span> <span class="o">=</span> <span class="n">ad</span><span class="o">.</span><span class="n">AnnData</span><span class="p">(</span>
    <span class="n">X</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">res</span><span class="p">),</span> <span class="mi">1</span><span class="p">)),</span>
    <span class="n">obs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;cell_type&#39;</span><span class="p">:</span> <span class="n">res</span><span class="p">},</span>
    <span class="n">obsm</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;spatial&#39;</span><span class="p">:</span> <span class="n">cell_location</span><span class="p">}</span>
<span class="p">)</span>
<br/></pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">spider_adata</span><span class="o">.</span><span class="n">obs</span><span class="o">.</span><span class="n">cell_type</span> <span class="o">=</span> <span class="n">spider_adata</span><span class="o">.</span><span class="n">obs</span><span class="o">.</span><span class="n">cell_type</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;category&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">spider_adata</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">spider_adata</span><span class="o">.</span><span class="n">obsm</span><span class="p">[</span><span class="s2">&quot;spatial&quot;</span><span class="p">][:,</span><span class="mi">0</span><span class="p">]</span>
<span class="n">spider_adata</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">spider_adata</span><span class="o">.</span><span class="n">obsm</span><span class="p">[</span><span class="s2">&quot;spatial&quot;</span><span class="p">][:,</span><span class="mi">1</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sc</span><span class="o">.</span><span class="n">pl</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">spider_adata</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s2">&quot;cell_type&quot;</span><span class="p">,</span><span class="n">x</span><span class="o">=</span><span class="s2">&quot;x&quot;</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="s2">&quot;y&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/TIME_simulation_10_0.png" class="no-scaled-link" src="_images/TIME_simulation_10_0.png" style="width: 412px; height: 379px;" />
</div>
</div>
</section>
<section id="Mixed">
<h2>Mixed<a class="headerlink" href="#Mixed" title="Link to this heading"></a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## Mixed</span>
<span class="n">prior</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.01</span><span class="p">,</span><span class="mf">0.33</span><span class="p">,</span><span class="mf">0.33</span><span class="p">,</span><span class="mf">0.33</span><span class="p">])</span>
<span class="n">Num_ct_sample</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">get_ct_sample</span><span class="p">(</span><span class="n">Num_celltype</span> <span class="o">=</span> <span class="n">Num_celltype</span><span class="p">,</span> <span class="n">Num_sample</span> <span class="o">=</span> <span class="n">Num_sample</span> <span class="p">,</span> <span class="n">prior</span> <span class="o">=</span> <span class="n">prior</span><span class="p">)</span>
<span class="n">target_trans</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">stripe_freq</span><span class="p">(</span><span class="n">Num_celltype</span><span class="p">)</span>
<span class="n">target_trans</span><span class="p">[</span><span class="mi">3</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.45</span><span class="p">,</span><span class="mf">0.05</span><span class="p">,</span><span class="mf">0.05</span><span class="p">,</span><span class="mf">0.45</span><span class="p">])</span>
<span class="n">target_trans</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
array([[0.45, 0.45, 0.05, 0.05],
       [0.05, 0.45, 0.45, 0.05],
       [0.05, 0.05, 0.45, 0.45],
       [0.45, 0.05, 0.05, 0.45]])
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[20]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">res</span><span class="p">,</span> <span class="n">cell_location</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">simulate_10X</span><span class="p">(</span><span class="n">cell_num</span><span class="o">=</span><span class="n">Num_sample</span><span class="p">,</span>
                                  <span class="n">Num_celltype</span><span class="o">=</span><span class="n">Num_celltype</span><span class="p">,</span>
                                  <span class="n">prior</span><span class="o">=</span><span class="n">prior</span><span class="p">,</span>
                                  <span class="n">target_trans</span><span class="o">=</span><span class="n">target_trans</span><span class="p">,</span>
                                  <span class="n">spot_radius</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                  <span class="n">spot_min</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                  <span class="n">spot_max</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                  <span class="n">image_width</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
                                  <span class="n">image_height</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
                                  <span class="n">cell_location</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                  <span class="n">tol</span><span class="o">=</span><span class="mf">2e-2</span><span class="p">,</span>
                                  <span class="n">T</span><span class="o">=</span><span class="mf">1e-2</span><span class="p">,</span>
                                  <span class="n">loop_times</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                  <span class="n">smallsample_max_iter</span><span class="o">=</span><span class="mi">150000</span><span class="p">,</span>
                                  <span class="n">bigsample_max_iter</span><span class="o">=</span><span class="mi">10000</span><span class="p">)</span>
<br/></pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
swap_num:  1
Refine cell type using Metropolis–Hastings algorithm.
Sample num:2500
10000 iteration, error 0.804
20000 iteration, error 0.796
30000 iteration, error 0.785
40000 iteration, error 0.794
50000 iteration, error 0.794
60000 iteration, error 0.771
70000 iteration, error 0.789
80000 iteration, error 0.789
90000 iteration, error 0.792
100000 iteration, error 0.793
110000 iteration, error 0.793
120000 iteration, error 0.795
130000 iteration, error 0.795
140000 iteration, error 0.786
150000 iteration, error 0.793
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[26]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">spider_adata</span> <span class="o">=</span> <span class="n">ad</span><span class="o">.</span><span class="n">AnnData</span><span class="p">(</span>
    <span class="n">X</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">res</span><span class="p">),</span> <span class="mi">1</span><span class="p">)),</span>
    <span class="n">obs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;cell_type&#39;</span><span class="p">:</span> <span class="n">res</span><span class="p">},</span>
    <span class="n">obsm</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;spatial&#39;</span><span class="p">:</span> <span class="n">cell_location</span><span class="p">}</span>
<span class="p">)</span>
<br/></pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[27]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">spider_adata</span><span class="o">.</span><span class="n">obs</span><span class="o">.</span><span class="n">cell_type</span> <span class="o">=</span> <span class="n">spider_adata</span><span class="o">.</span><span class="n">obs</span><span class="o">.</span><span class="n">cell_type</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;category&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[28]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">spider_adata</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">spider_adata</span><span class="o">.</span><span class="n">obsm</span><span class="p">[</span><span class="s2">&quot;spatial&quot;</span><span class="p">][:,</span><span class="mi">0</span><span class="p">]</span>
<span class="n">spider_adata</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">spider_adata</span><span class="o">.</span><span class="n">obsm</span><span class="p">[</span><span class="s2">&quot;spatial&quot;</span><span class="p">][:,</span><span class="mi">1</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[29]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sc</span><span class="o">.</span><span class="n">pl</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">spider_adata</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s2">&quot;cell_type&quot;</span><span class="p">,</span><span class="n">x</span><span class="o">=</span><span class="s2">&quot;x&quot;</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="s2">&quot;y&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/TIME_simulation_17_0.png" class="no-scaled-link" src="_images/TIME_simulation_17_0.png" style="width: 412px; height: 379px;" />
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
</div>
</section>
<section id="Compartmentalized">
<h2>Compartmentalized<a class="headerlink" href="#Compartmentalized" title="Link to this heading"></a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[31]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## Compartmentalized</span>
<span class="n">prior</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.80</span><span class="p">,</span><span class="mf">0.03</span><span class="p">,</span><span class="mf">0.02</span><span class="p">,</span><span class="mf">0.15</span><span class="p">])</span>
<span class="n">Num_ct_sample</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">get_ct_sample</span><span class="p">(</span><span class="n">Num_celltype</span> <span class="o">=</span> <span class="n">Num_celltype</span><span class="p">,</span> <span class="n">Num_sample</span> <span class="o">=</span>  <span class="n">Num_sample</span><span class="p">,</span> <span class="n">prior</span> <span class="o">=</span> <span class="n">prior</span><span class="p">)</span>
<span class="n">target_trans</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">addictive_freq</span><span class="p">(</span><span class="n">Num_celltype</span><span class="p">)</span>
<span class="n">target_trans</span><span class="p">[</span><span class="mi">1</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.01</span><span class="p">,</span><span class="mf">0.33</span><span class="p">,</span><span class="mf">0.33</span><span class="p">,</span><span class="mf">0.33</span><span class="p">])</span>
<span class="n">target_trans</span><span class="p">[</span><span class="mi">2</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.01</span><span class="p">,</span><span class="mf">0.33</span><span class="p">,</span><span class="mf">0.33</span><span class="p">,</span><span class="mf">0.33</span><span class="p">])</span>
<span class="n">target_trans</span><span class="p">[</span><span class="mi">3</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">addictive_freq</span><span class="p">(</span><span class="n">Num_celltype</span><span class="p">)[</span><span class="mi">3</span><span class="p">,:]</span>
<span class="n">target_trans</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[31]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
array([[0.8       , 0.06666667, 0.06666667, 0.06666667],
       [0.01      , 0.33      , 0.33      , 0.33      ],
       [0.01      , 0.33      , 0.33      , 0.33      ],
       [0.06666667, 0.06666667, 0.06666667, 0.8       ]])
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[32]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">res</span><span class="p">,</span> <span class="n">cell_location</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">simulate_10X</span><span class="p">(</span><span class="n">cell_num</span><span class="o">=</span><span class="n">Num_sample</span><span class="p">,</span>
                                  <span class="n">Num_celltype</span><span class="o">=</span><span class="n">Num_celltype</span><span class="p">,</span>
                                  <span class="n">prior</span><span class="o">=</span><span class="n">prior</span><span class="p">,</span>
                                  <span class="n">target_trans</span><span class="o">=</span><span class="n">target_trans</span><span class="p">,</span>
                                  <span class="n">spot_radius</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                  <span class="n">spot_min</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                  <span class="n">spot_max</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                  <span class="n">image_width</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
                                  <span class="n">image_height</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
                                  <span class="n">cell_location</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                  <span class="n">tol</span><span class="o">=</span><span class="mf">2e-2</span><span class="p">,</span>
                                  <span class="n">T</span><span class="o">=</span><span class="mf">1e-2</span><span class="p">,</span>
                                  <span class="n">loop_times</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                  <span class="n">smallsample_max_iter</span><span class="o">=</span><span class="mi">150000</span><span class="p">,</span>
                                  <span class="n">bigsample_max_iter</span><span class="o">=</span><span class="mi">10000</span><span class="p">)</span>
<br/></pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
swap_num:  1
Refine cell type using Metropolis–Hastings algorithm.
Sample num:2500
10000 iteration, error 0.696
20000 iteration, error 0.552
30000 iteration, error 0.514
40000 iteration, error 0.462
50000 iteration, error 0.476
60000 iteration, error 0.474
70000 iteration, error 0.467
80000 iteration, error 0.465
90000 iteration, error 0.467
100000 iteration, error 0.468
110000 iteration, error 0.474
120000 iteration, error 0.467
130000 iteration, error 0.472
140000 iteration, error 0.474
150000 iteration, error 0.475
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[33]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">spider_adata</span> <span class="o">=</span> <span class="n">ad</span><span class="o">.</span><span class="n">AnnData</span><span class="p">(</span>
    <span class="n">X</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">res</span><span class="p">),</span> <span class="mi">1</span><span class="p">)),</span>
    <span class="n">obs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;cell_type&#39;</span><span class="p">:</span> <span class="n">res</span><span class="p">},</span>
    <span class="n">obsm</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;spatial&#39;</span><span class="p">:</span> <span class="n">cell_location</span><span class="p">}</span>
<span class="p">)</span>
<br/></pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[34]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">spider_adata</span><span class="o">.</span><span class="n">obs</span><span class="o">.</span><span class="n">cell_type</span> <span class="o">=</span> <span class="n">spider_adata</span><span class="o">.</span><span class="n">obs</span><span class="o">.</span><span class="n">cell_type</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;category&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[35]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">spider_adata</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">spider_adata</span><span class="o">.</span><span class="n">obsm</span><span class="p">[</span><span class="s2">&quot;spatial&quot;</span><span class="p">][:,</span><span class="mi">0</span><span class="p">]</span>
<span class="n">spider_adata</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">spider_adata</span><span class="o">.</span><span class="n">obsm</span><span class="p">[</span><span class="s2">&quot;spatial&quot;</span><span class="p">][:,</span><span class="mi">1</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[36]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sc</span><span class="o">.</span><span class="n">pl</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">spider_adata</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s2">&quot;cell_type&quot;</span><span class="p">,</span><span class="n">x</span><span class="o">=</span><span class="s2">&quot;x&quot;</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="s2">&quot;y&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/TIME_simulation_25_0.png" class="no-scaled-link" src="_images/TIME_simulation_25_0.png" style="width: 412px; height: 379px;" />
</div>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="Benchmark_datasets_generation.html" class="btn btn-neutral float-left" title="Benchmark datasets generation" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="3D_simulation.html" class="btn btn-neutral float-right" title="3D ST dataset simulation" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, Jiyuan Yang.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>